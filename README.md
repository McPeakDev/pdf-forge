# pdf-forge

[![CI](https://github.com/McPeakDev/pdf-forge/actions/workflows/ci.yml/badge.svg)](https://github.com/McPeakDev/pdf-forge/actions/workflows/ci.yml)
[![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

**pdf-forge** is a template-driven HTML → PDF pipeline written in Rust.  
It ships as:

- **`forge`** — a stand-alone CLI binary
- **`pdf_forge`** — a Rust library crate
- **`libpdf_forge`** — a C-compatible shared/static library with a stable `extern "C"` ABI, consumable from Go, C, C++, Python, or any language with FFI support

---

## Features

- Converts HTML + inline CSS to paginated PDF (A4 portrait or landscape)
- Flexbox layout engine ([taffy](https://github.com/DioxusLabs/taffy))
- Helvetica built-in font with bold, italic, underline support
- Embedded images via `data:image/png;base64,…` or `data:image/jpeg;base64,…` URIs  
  (external URLs are silently skipped)
- Page breaks via `.page`, `.page-break` CSS classes or `break-after: page`
- Tables rendered as CSS grid
- Ordered and unordered lists with markers
- `display: none` support
- Custom document title embedded in PDF metadata
- C header auto-generated by [cbindgen](https://github.com/mozilla/cbindgen)
- Cross-platform: Linux (x86_64 + arm64), macOS (x86_64 + arm64 + universal), Windows (x86_64)

---

## Quick start

### CLI

```sh
# Install from source
cargo install --path .

# Convert HTML to PDF
forge report.html

# Specify output path, landscape orientation, and document title
forge report.html out/report.pdf --landscape --title "Q4 Report"
```

**Flags**

| Flag             | Short | Description                                                   |
| ---------------- | ----- | ------------------------------------------------------------- |
| `--title <name>` | `-t`  | Document title in PDF metadata (default: input filename stem) |
| `--landscape`    | `-l`  | Landscape orientation (A4 841×595 pt)                         |
| `--help`         | `-h`  | Print usage                                                   |

### Rust library

```toml
# Cargo.toml
[dependencies]
pdf-forge = { git = "https://github.com/McPeakDev/pdf-forge" }
```

```rust
use pdf_forge::pipeline::{generate_pdf, PipelineConfig};

let html = std::fs::read_to_string("report.html")?;
let config = PipelineConfig {
    title: "My Report".into(),
    ..PipelineConfig::default()
};
let (pdf_bytes, _layout) = generate_pdf(&html, &config)?;
std::fs::write("report.pdf", &pdf_bytes)?;
```

---

## HTML templating

See [docs/templating.md](docs/templating.md) for the full reference.  
Ready-made templates live in [templates/](templates/).

Key conventions:

```html
<!-- Page break -->
<div class="page-break"></div>

<!-- Embedded image (base64 only) -->
<img src="data:image/png;base64,..." style="width:200px; height:100px" />

<!-- Landscape hint (set on <body> or a wrapper) -->
<!-- Use --landscape CLI flag or PageOrientation::Landscape in code -->
```

---

## C / FFI library

`cargo build --release` produces:

| Platform | Dynamic              | Static           |
| -------- | -------------------- | ---------------- |
| Linux    | `libpdf_forge.so`    | `libpdf_forge.a` |
| macOS    | `libpdf_forge.dylib` | `libpdf_forge.a` |
| Windows  | `pdf_forge.dll`      | `pdf_forge.lib`  |

The public header is at **`include/rpdf.h`** (auto-generated; do not edit manually).

### Minimal C example

```c
#include "rpdf.h"
#include <stdio.h>
#include <stdlib.h>

int main(void) {
    const char *html = "<h1>Hello, PDF!</h1>";
    uint8_t *buf = NULL;
    uint32_t len = 0;

    if (rpdf_generate_pdf((const uint8_t *)html, (uint32_t)strlen(html), &buf, &len) != 0) {
        fprintf(stderr, "error: %s\n", rpdf_last_error());
        return 1;
    }

    FILE *f = fopen("out.pdf", "wb");
    fwrite(buf, 1, len, f);
    fclose(f);

    rpdf_free_buffer(buf, len);
    return 0;
}
```

Link flags:

```sh
# Linux / macOS
gcc example.c -I include -L target/release -lpdf_forge -lpthread -ldl -lm -o example

# Windows (MSVC)
cl example.c /I include /link /LIBPATH:target\release pdf_forge.lib Ws2_32.lib Bcrypt.lib Ntdll.lib Userenv.lib
```

A full working example is in [examples/example.c](examples/example.c).  
Build it with [`scripts/build_example.bat`](scripts/build_example.bat) (Windows) or [`scripts/build_example.sh`](scripts/build_example.sh) (Linux/macOS).

### Go (cgo)

See [docs/go-bindings.md](docs/go-bindings.md) for a complete walkthrough.  
A working example is in [examples/go/main.go](examples/go/main.go).

```go
/*
#cgo CFLAGS: -I../../include
#cgo linux  LDFLAGS: -L../../target/release -lpdf_forge -lpthread -ldl -lm
#cgo darwin LDFLAGS: -L../../target/release -lpdf_forge -lpthread -ldl -lm
#cgo windows LDFLAGS: -L../../target/release -lpdf_forge -lws2_32 -lbcrypt -lntdll -luserenv
#include "rpdf.h"
*/
import "C"
```

---

## API overview

| Function                        | Description                                             |
| ------------------------------- | ------------------------------------------------------- |
| `rpdf_generate_pdf`             | HTML → PDF bytes                                        |
| `rpdf_generate_pdf_with_layout` | HTML → PDF bytes + layout JSON                          |
| `rpdf_compute_layout`           | HTML → layout JSON only (no rendering)                  |
| `rpdf_render_from_layout`       | layout JSON → PDF bytes                                 |
| `rpdf_free_buffer`              | Free a PDF byte buffer                                  |
| `rpdf_free_string`              | Free a JSON string                                      |
| `rpdf_last_error`               | Retrieve last error message (thread-local, do not free) |
| `rpdf_version`                  | Library version string (do not free)                    |

**Return codes:** `0` success · `1` null pointer · `2` invalid UTF-8 · `3` pipeline error · `4` render error

---

## Building

```sh
# Debug build (runs cbindgen to regenerate include/rpdf.h)
cargo build

# Release build
cargo build --release

# Run tests
cargo test --lib

# Run the Rust example
cargo run --example generate_pdf -- templates/minimal.html out.pdf
```

---

## CI / Releases

GitHub Actions ([`.github/workflows/ci.yml`](.github/workflows/ci.yml)) runs on every push and pull request:

- Tests on **Ubuntu**, **macOS**, and **Windows**
- Cross-compiles for **Linux arm64**

On a `v*` tag, release archives are uploaded automatically:

| Archive                            | Platform                 |
| ---------------------------------- | ------------------------ |
| `pdf-forge-linux-x86_64.tar.gz`    | Linux x86_64             |
| `pdf-forge-linux-arm64.tar.gz`     | Linux arm64              |
| `pdf-forge-macos-x86_64.tar.gz`    | macOS x86_64             |
| `pdf-forge-macos-arm64.tar.gz`     | macOS arm64              |
| `pdf-forge-macos-universal.tar.gz` | macOS universal (`lipo`) |
| `pdf-forge-windows-x86_64.zip`     | Windows x86_64           |

Each archive contains the dynamic library, static library, CLI binary, and `rpdf.h`.

---

## License

[MIT](LICENSE) © 2026 McPeakDev
